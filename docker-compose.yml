version: "3"
services:
    grafana:
        image: grafana/grafana:7.1.5
        container_name: grafana
        ports:
            - "3000:3000"
        volumes:
            - ~/docker/grafana:/var/lib/grafana
        networks:
            - web
    prometheus:
        image: prom/prometheus:v2.20.1
        container_name: prometheus
        ports:
            - "9090:9090"
        volumes:
            - ~/docker/prometheus:/etc/prometheus
        networks:
            - sushii_net
            - web
    postgres:
        image: postgres:12
        container_name: postgres
        restart: unless-stopped
        env_file:
            - .env
        volumes:
            - ~/docker/postgres:/var/lib/postgresql/data
        networks:
            - sushii_net
    sushii:
        image: docker.pkg.github.com/drklee3/sushii-2/sushii-2:latest
        container_name: sushii
        restart: unless-stopped
        depends_on:
            - postgres
        expose:
            - "9888"
        logging:
            driver: json-file
            options:
                max-size: "10m"
                max-file: "3"
                mode: non-blocking
                max-buffer-size: 4m
        env_file:
            - .env
        networks:
            - sushii_net
networks:
    web:
        external: false
    sushii_net:
        external: false
